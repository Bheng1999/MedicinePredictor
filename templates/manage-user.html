{% extends "navsidebar.html" %}

{% block title %}
    MediPredict | Manage Users
{% endblock title %}

{% block style %}

    :root {
        --primary: #4a6cf7;
        --primary-dark: #3a5ce5;
        --primary-light: #6b8cff;
        --secondary: #764ba2;
        --accent: #00d4ff;
        --dark: #1a1a2e;
        --light: #f8fafc;
        --gray: #64748b;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --info: #06b6d4;
    }

    /* ==================== PAGE HEADER ==================== */
    .page-header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        border-radius: 1.5rem;
        padding: 2rem;
        margin-bottom: 2rem;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -10%;
        width: 300px;
        height: 300px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }

    .page-header::after {
        content: '';
        position: absolute;
        bottom: -30%;
        left: 10%;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 50%;
    }

    .page-header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        z-index: 1;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .page-header h1 {
        font-size: 1.75rem;
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .page-header p {
        margin: 0.5rem 0 0;
        opacity: 0.9;
    }

    .btn-add-user {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.875rem 1.5rem;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 0.75rem;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-add-user:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
    }

    .btn-add-user i {
        font-size: 1.25rem;
    }

    /* ==================== FILTER CARD ==================== */
    .filter-card {
        background: white;
        border-radius: 1.25rem;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
        overflow: visible;
        margin-bottom: 1.5rem;
        position: relative;
        z-index: 10;
    }

    .filter-card-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .filter-card-header i {
        font-size: 1.5rem;
        color: var(--primary);
    }

    .filter-card-header h5 {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--dark);
        margin: 0;
    }

    .filter-card-body {
        padding: 1.5rem;
        overflow: visible;
    }

    /* Filter Grid */
    .filter-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 1rem;
    }

    @media (max-width: 768px) {
        .filter-grid {
            grid-template-columns: 1fr;
        }
    }

    .filter-group {
        display: flex;
        flex-direction: column;
    }

    .filter-label {
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--gray);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Search Input */
    .search-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
    }

    .search-input-wrapper i {
        position: absolute;
        left: 1rem;
        color: var(--gray);
        font-size: 1.25rem;
        pointer-events: none;
    }

    .search-input {
        width: 100%;
        padding: 0.875rem 1rem 0.875rem 3rem;
        border: 2px solid #e2e8f0;
        border-radius: 0.75rem;
        font-size: 0.95rem;
        color: var(--dark);
        transition: all 0.3s ease;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(74, 108, 247, 0.1);
    }

    .search-input::placeholder {
        color: #94a3b8;
    }

    /* Role Select */
    .role-select {
        width: 100%;
        padding: 0.875rem 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 0.75rem;
        font-size: 0.95rem;
        color: var(--dark);
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='%2364748b'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        padding-right: 2.5rem;
    }

    .role-select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(74, 108, 247, 0.1);
    }

    /* Filter Tags */
    .filter-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        min-height: 36px;
        margin-top: 1rem;
    }

    .filter-tag {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: linear-gradient(135deg, rgba(74, 108, 247, 0.1), rgba(118, 75, 162, 0.1));
        color: var(--primary);
        border: 1px solid rgba(74, 108, 247, 0.2);
        border-radius: 50px;
        padding: 0.375rem 0.75rem 0.375rem 1rem;
        font-size: 0.8rem;
        font-weight: 600;
        animation: tagAppear 0.3s ease;
    }

    @keyframes tagAppear {
        from {
            opacity: 0;
            transform: scale(0.8);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .filter-tag-remove {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(74, 108, 247, 0.2);
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .filter-tag-remove:hover {
        background: var(--danger);
        color: white;
    }

    .filter-tag-remove i {
        font-size: 0.875rem;
    }

    /* ==================== USERS TABLE CARD ==================== */
    .table-card {
        background: white;
        border-radius: 1.25rem;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
        overflow: hidden;
    }

    .table-card-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .table-card-title {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .table-card-title i {
        font-size: 1.5rem;
        color: var(--primary);
    }

    .table-card-title h5 {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--dark);
        margin: 0;
    }

    .user-count-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: linear-gradient(135deg, rgba(74, 108, 247, 0.1), rgba(118, 75, 162, 0.1));
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--primary);
    }

    .table-card-body {
        padding: 0;
    }

    /* Users Table */
    .users-table {
        width: 100%;
        border-collapse: collapse;
    }

    .users-table thead th {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        padding: 1rem 1.5rem;
        font-size: 0.75rem;
        font-weight: 700;
        color: var(--gray);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 2px solid #e2e8f0;
        white-space: nowrap;
    }

    .users-table tbody td {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #f1f5f9;
        vertical-align: middle;
    }

    .users-table tbody tr {
        transition: background-color 0.2s ease;
    }

    .users-table tbody tr:hover {
        background-color: #f8fafc;
    }

    .users-table tbody tr:last-child td {
        border-bottom: none;
    }

    /* User Avatar */
    .user-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1rem;
        flex-shrink: 0;
        box-shadow: 0 4px 12px rgba(74, 108, 247, 0.3);
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .user-details h6 {
        margin: 0;
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--dark);
    }

    .user-details span {
        font-size: 0.8rem;
        color: var(--gray);
    }

    .user-email {
        color: var(--gray);
        font-size: 0.9rem;
    }

    /* Role Badges */
    .role-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.375rem 0.875rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .role-superuser {
        background: linear-gradient(135deg, #8b5cf6, #6d28d9);
        color: white;
    }

    .role-admin {
        background: linear-gradient(135deg, rgba(74, 108, 247, 0.15), rgba(74, 108, 247, 0.25));
        color: var(--primary);
    }

    .role-pharmacist {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.25));
        color: var(--success);
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 0.5rem;
    }

    .btn-action {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.375rem;
        padding: 0.5rem 0.875rem;
        border: 2px solid;
        border-radius: 0.5rem;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        background: transparent;
    }

    .btn-action i {
        font-size: 1rem;
    }

    .btn-action-view {
        border-color: var(--primary);
        color: var(--primary);
    }

    .btn-action-view:hover {
        background: var(--primary);
        color: white;
    }

    .btn-action-logs {
        border-color: var(--info);
        color: var(--info);
    }

    .btn-action-logs:hover {
        background: var(--info);
        color: white;
    }

    .btn-action-delete {
        border-color: var(--danger);
        color: var(--danger);
    }

    .btn-action-delete:hover:not(:disabled) {
        background: var(--danger);
        color: white;
    }

    .btn-action:disabled {
        opacity: 0.4;
        cursor: not-allowed;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
    }

    .empty-state-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, rgba(74, 108, 247, 0.1), rgba(118, 75, 162, 0.1));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
    }

    .empty-state-icon i {
        font-size: 2.5rem;
        color: var(--primary);
    }

    .empty-state h6 {
        color: var(--dark);
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: var(--gray);
        margin: 0;
    }

    /* ==================== MODALS ==================== */
    .modal-content {
        border: none;
        border-radius: 1.25rem;
        overflow: hidden;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        padding: 1.25rem 1.5rem;
        border-bottom: none;
    }

    .modal-header .modal-title {
        font-weight: 700;
        font-size: 1.1rem;
    }

    .modal-header .btn-close {
        filter: brightness(0) invert(1);
        opacity: 0.8;
    }

    .modal-header .btn-close:hover {
        opacity: 1;
    }

    .modal-body {
        padding: 1.5rem;
    }

    .modal-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid #e2e8f0;
        background: #f8fafc;
    }

    /* Form Styles */
    .form-group {
        margin-bottom: 1.25rem;
    }

    .form-label {
        display: block;
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 0.5rem;
    }

    .form-label .required {
        color: var(--danger);
    }

    .form-input {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 0.75rem;
        font-size: 0.95rem;
        color: var(--dark);
        transition: all 0.3s ease;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(74, 108, 247, 0.1);
    }

    .form-input.is-invalid {
        border-color: var(--danger);
    }

    .form-hint {
        font-size: 0.75rem;
        color: var(--gray);
        margin-top: 0.375rem;
    }

    .invalid-feedback {
        font-size: 0.75rem;
        color: var(--danger);
        margin-top: 0.375rem;
    }

    .form-row {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }

    @media (max-width: 576px) {
        .form-row {
            grid-template-columns: 1fr;
        }
    }

    /* Modal Buttons */
    .btn-modal {
        padding: 0.75rem 1.5rem;
        border-radius: 0.75rem;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .btn-modal-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    .btn-modal-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(74, 108, 247, 0.3);
    }

    .btn-modal-secondary {
        background: white;
        border-color: #e2e8f0;
        color: var(--gray);
    }

    .btn-modal-secondary:hover {
        border-color: var(--dark);
        color: var(--dark);
    }

    .btn-modal-danger {
        background: linear-gradient(135deg, var(--danger), #dc2626);
        color: white;
    }

    .btn-modal-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
    }

    /* View User Modal */
    .user-profile {
        text-align: center;
        padding: 1rem 0 1.5rem;
    }

    .user-profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 2rem;
        margin: 0 auto 1rem;
        box-shadow: 0 8px 24px rgba(74, 108, 247, 0.3);
    }

    .user-profile h4 {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 0.25rem;
    }

    .user-profile p {
        color: var(--gray);
        margin: 0;
    }

    .user-info-card {
        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        border-radius: 1rem;
        padding: 1.25rem;
        text-align: center;
        margin-bottom: 1.5rem;
    }

    .user-info-card-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--gray);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
    }

    .user-details-table {
        width: 100%;
    }

    .user-details-table tr td {
        padding: 0.75rem 0;
        border-bottom: 1px solid #e2e8f0;
    }

    .user-details-table tr:last-child td {
        border-bottom: none;
    }

    .user-details-table .label {
        font-weight: 600;
        color: var(--gray);
        width: 40%;
    }

    .user-details-table .value {
        color: var(--dark);
    }

    /* Logs Modal */
    .logs-user-info {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        border-radius: 1rem;
        margin-bottom: 1.5rem;
    }

    .logs-container {
        max-height: 400px;
        overflow-y: auto;
    }

    .log-item {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding: 1rem;
        border-radius: 0.75rem;
        background: #f8fafc;
        margin-bottom: 0.75rem;
        transition: all 0.2s ease;
    }

    .log-item:hover {
        background: #e2e8f0;
    }

    .log-item:last-child {
        margin-bottom: 0;
    }

    .log-content {
        flex: 1;
    }

    .log-action {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .log-action i {
        font-size: 1rem;
    }

    .log-success {
        color: var(--success);
    }

    .log-warning {
        color: var(--warning);
    }

    .log-error {
        color: var(--danger);
    }

    .log-info {
        color: var(--info);
    }

    .log-details {
        font-size: 0.85rem;
        color: var(--gray);
        margin-top: 0.375rem;
    }

    .log-time {
        font-size: 0.75rem;
        color: var(--gray);
        white-space: nowrap;
    }

    /* Delete Modal */
    .delete-warning {
        text-align: center;
        padding: 1rem 0;
    }

    .delete-warning-icon {
        width: 80px;
        height: 80px;
        background: rgba(239, 68, 68, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
    }

    .delete-warning-icon i {
        font-size: 2.5rem;
        color: var(--danger);
    }

    .delete-warning h5 {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 0.5rem;
    }

    .delete-warning p {
        color: var(--gray);
        margin-bottom: 0.25rem;
    }

    .delete-warning .username {
        font-weight: 700;
        color: var(--dark);
        font-size: 1.1rem;
    }

    .delete-warning .warning-text {
        color: var(--danger);
        font-size: 0.85rem;
        margin-top: 1rem;
    }

    /* ==================== PAGINATION ==================== */
    .pagination-wrapper {
        padding: 1.5rem;
        border-top: 1px solid #e2e8f0;
    }

    .pagination-nav {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.25rem;
    }

    .pagination-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 40px;
        height: 40px;
        padding: 0 0.75rem;
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 0.5rem;
        color: var(--gray);
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
    }

    .pagination-btn:hover:not(.active):not(.disabled) {
        border-color: var(--primary);
        color: var(--primary);
    }

    .pagination-btn.active {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-color: transparent;
        color: white;
    }

    .pagination-btn.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 992px) {
        .action-buttons {
            flex-direction: column;
        }

        .btn-action {
            width: 100%;
            justify-content: center;
        }
    }

    @media (max-width: 768px) {
        .page-header {
            padding: 1.5rem;
            border-radius: 1rem;
        }

        .page-header h1 {
            font-size: 1.5rem;
        }

        .page-header-content {
            flex-direction: column;
            align-items: stretch;
        }

        .btn-add-user {
            justify-content: center;
        }

        .users-table thead {
            display: none;
        }

        .users-table tbody tr {
            display: block;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            background: white;
        }

        .users-table tbody tr:hover {
            background: white;
        }

        .users-table tbody td {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .users-table tbody td::before {
            content: attr(data-label);
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .users-table tbody td:last-child {
            border-bottom: none;
            padding-top: 1rem;
        }

        .users-table tbody td:last-child::before {
            display: none;
        }

        .user-info {
            flex-direction: row;
        }

        .action-buttons {
            flex-direction: row;
            width: 100%;
        }

        .btn-action {
            flex: 1;
        }

        .btn-action span {
            display: none;
        }
    }

    @media (max-width: 576px) {
        .main-content .p-3,
        .main-content .p-md-4 {
            padding: 1rem !important;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            font-size: 0.875rem;
        }

        .modal-lg {
            margin: 0.5rem;
        }
    }

    /* Scrollbar Styling */
    .logs-container::-webkit-scrollbar {
        width: 6px;
    }

    .logs-container::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
    }

    .logs-container::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }

    .logs-container::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }
{% endblock style %}

{% block content %}
<!-- Main Content -->
<div class="col-lg-9 col-xl-10 main-content" id="mainContent">
    <div class="p-3 p-md-4">
        <!-- Page Header -->
        <div class="page-header">
            <div class="page-header-content">
                <div>
                    <h1>
                        <i class="material-icons">people</i>
                        Manage Users
                    </h1>
                    <p>Add, view, and manage system users</p>
                </div>
                <button type="button" class="btn-add-user" id="addUserBtn">
                    <i class="material-icons">person_add</i>
                    <span>Add New User</span>
                </button>
            </div>
        </div>

        <!-- Filter Card -->
        <div class="filter-card">
            <div class="filter-card-header">
                <i class="material-icons">filter_alt</i>
                <h5>Search & Filter</h5>
            </div>
            <div class="filter-card-body">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label">Search Users</label>
                        <div class="search-input-wrapper">
                            <i class="material-icons">search</i>
                            <input type="text" class="search-input" id="userSearch" placeholder="Search by name, username, or email...">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Filter by Role</label>
                        <select class="role-select" id="roleFilter">
                            <option value="">All Roles</option>
                            <option value="superuser">Superuser</option>
                            <option value="admin">Admin</option>
                            <option value="pharmacist">Pharmacist</option>
                        </select>
                    </div>
                </div>
                <div class="filter-tags" id="userFilterTags"></div>
            </div>
        </div>

        <!-- Users Table Card -->
        <div class="table-card">
            <div class="table-card-header">
                <div class="table-card-title">
                    <i class="material-icons">group</i>
                    <h5>All Users</h5>
                </div>
                <div class="user-count-badge">
                    <i class="material-icons" style="font-size: 1rem;">people</i>
                    <span id="userCount">{{ users|length }}</span> Users
                </div>
            </div>
            <div class="table-card-body">
                <div class="table-responsive">
                    <table class="users-table" id="usersTable">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            {% for user in users %}
                            <tr>
                                <td data-label="User">
                                    <div class="user-info">
                                        <div class="user-avatar">
                                            {% if user.first_name and user.last_name %}
                                                {{ user.first_name|slice:":1" }}{{ user.last_name|slice:":1" }}
                                            {% else %}
                                                {{ user.username|slice:":2"|upper }}
                                            {% endif %}
                                        </div>
                                        <div class="user-details">
                                            <h6>
                                                {% if user.first_name and user.last_name %}
                                                    {{ user.first_name }} {{ user.last_name }}
                                                {% else %}
                                                    {{ user.username }}
                                                {% endif %}
                                            </h6>
                                            <span>@{{ user.username }}</span>
                                        </div>
                                    </div>
                                </td>
                                <td data-label="Email">
                                    <span class="user-email">{{ user.email }}</span>
                                </td>
                                <td data-label="Role">
                                    <span class="role-badge 
                                        {% if user.is_superuser %}role-superuser
                                        {% elif user.role == 'admin' %}role-admin
                                        {% elif user.role == 'pharmacist' %}role-pharmacist{% endif %}">
                                        {% if user.is_superuser %}Superuser
                                        {% else %}{{ user.role|title }}{% endif %}
                                    </span>
                                </td>
                                <td data-label="Actions">
                                    <div class="action-buttons">
                                        <button type="button" class="btn-action btn-action-view" 
                                                data-bs-toggle="modal" 
                                                data-bs-target="#viewUserModal{{ user.id }}"
                                                title="View Details">
                                            <i class="material-icons">visibility</i>
                                            <span>View</span>
                                        </button>
                                        <button type="button" class="btn-action btn-action-logs" 
                                                data-bs-toggle="modal" 
                                                data-bs-target="#userLogsModal{{ user.id }}"
                                                title="View Logs">
                                            <i class="material-icons">history</i>
                                            <span>Logs</span>
                                        </button>
                                        <button type="button" class="btn-action btn-action-delete" 
                                                data-bs-toggle="modal" 
                                                data-bs-target="#confirmDeleteModal{{ user.id }}"
                                                {% if user.is_superuser or user == request.user %}disabled{% endif %}
                                                title="Delete User">
                                            <i class="material-icons">delete</i>
                                            <span>Delete</span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4">
                                    <div class="empty-state">
                                        <div class="empty-state-icon">
                                            <i class="material-icons">people</i>
                                        </div>
                                        <h6>No Users Found</h6>
                                        <p>No users match your current filters</p>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                {% if users.paginator.num_pages > 1 %}
                <div class="pagination-wrapper">
                    <nav class="pagination-nav">
                        {% if users.has_previous %}
                        <a href="?page={{ users.previous_page_number }}" class="pagination-btn">
                            <i class="material-icons" style="font-size: 1.25rem;">chevron_left</i>
                        </a>
                        {% else %}
                        <span class="pagination-btn disabled">
                            <i class="material-icons" style="font-size: 1.25rem;">chevron_left</i>
                        </span>
                        {% endif %}
                        
                        {% for num in users.paginator.page_range %}
                            {% if users.number == num %}
                            <span class="pagination-btn active">{{ num }}</span>
                            {% else %}
                            <a href="?page={{ num }}" class="pagination-btn">{{ num }}</a>
                            {% endif %}
                        {% endfor %}
                        
                        {% if users.has_next %}
                        <a href="?page={{ users.next_page_number }}" class="pagination-btn">
                            <i class="material-icons" style="font-size: 1.25rem;">chevron_right</i>
                        </a>
                        {% else %}
                        <span class="pagination-btn disabled">
                            <i class="material-icons" style="font-size: 1.25rem;">chevron_right</i>
                        </span>
                        {% endif %}
                    </nav>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Add User Modal -->
<div class="modal fade" id="userModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form method="post" action="{% url 'add_user' %}" id="addUserForm">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="material-icons me-2" style="font-size: 1.25rem;">person_add</i>
                        Add New User
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">First Name <span class="required">*</span></label>
                            <input type="text" class="form-input" name="firstname" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Last Name <span class="required">*</span></label>
                            <input type="text" class="form-input" name="lastname" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Username <span class="required">*</span></label>
                        <input type="text" class="form-input" name="username" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="grid-column: span 2;">
                            <label class="form-label">Email Address <span class="required">*</span></label>
                            <input type="email" class="form-input" name="email" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Role <span class="required">*</span></label>
                        <select class="form-input" name="role" required>
                            <option value="">Select Role</option>
                            <option value="pharmacist">Pharmacist</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password <span class="required">*</span></label>
                        <input type="password" class="form-input" name="password" id="password" required minlength="8">
                        <span class="form-hint">Minimum 8 characters</span>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirm Password <span class="required">*</span></label>
                        <input type="password" class="form-input" name="password_confirm" id="password_confirm" required minlength="8">
                        <span class="invalid-feedback" id="passwordError">Passwords do not match</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-modal btn-modal-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn-modal btn-modal-primary">
                        <i class="material-icons me-1" style="font-size: 1.1rem;">save</i>
                        Save User
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- View User Modals -->
{% for user in users %}
<div class="modal fade" id="viewUserModal{{ user.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="material-icons me-2" style="font-size: 1.25rem;">person</i>
                    User Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="user-profile">
                    <div class="user-profile-avatar">
                        {% if user.first_name and user.last_name %}
                            {{ user.first_name|slice:":1" }}{{ user.last_name|slice:":1" }}
                        {% else %}
                            {{ user.username|slice:":2"|upper }}
                        {% endif %}
                    </div>
                    <h4>
                        {% if user.first_name and user.last_name %}
                            {{ user.first_name }} {{ user.last_name }}
                        {% else %}
                            {{ user.username }}
                        {% endif %}
                    </h4>
                    <p>{{ user.email }}</p>
                </div>
                
                <div class="user-info-card">
                    <div class="user-info-card-label">Role</div>
                    <span class="role-badge 
                        {% if user.is_superuser %}role-superuser
                        {% elif user.role == 'admin' %}role-admin
                        {% elif user.role == 'pharmacist' %}role-pharmacist{% endif %}">
                        {% if user.is_superuser %}Superuser
                        {% else %}{{ user.role|title }}{% endif %}
                    </span>
                </div>
                
                <h6 style="font-weight: 700; color: var(--dark); margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 2px solid #e2e8f0;">
                    Account Information
                </h6>
                
                <table class="user-details-table">
                    <tr>
                        <td class="label">Username</td>
                        <td class="value">{{ user.username }}</td>
                    </tr>
                    <tr>
                        <td class="label">Account Created</td>
                        <td class="value">{{ user.date_joined|date:"M d, Y H:i" }}</td>
                    </tr>
                    <tr>
                        <td class="label">Last Login</td>
                        <td class="value">{{ user.last_login|date:"M d, Y H:i"|default:"Never" }}</td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-modal btn-modal-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- User Logs Modals -->
{% for user in users %}
<div class="modal fade" id="userLogsModal{{ user.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="material-icons me-2" style="font-size: 1.25rem;">history</i>
                    Activity Logs
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="logs-user-info">
                    <div class="user-avatar">
                        {% if user.first_name and user.last_name %}
                            {{ user.first_name|slice:":1" }}{{ user.last_name|slice:":1" }}
                        {% else %}
                            {{ user.username|slice:":2"|upper }}
                        {% endif %}
                    </div>
                    <div>
                        <h6 style="margin: 0; font-weight: 600; color: var(--dark);">
                            {% if user.first_name and user.last_name %}
                                {{ user.first_name }} {{ user.last_name }}
                            {% else %}
                                {{ user.username }}
                            {% endif %}
                        </h6>
                        <span style="font-size: 0.85rem; color: var(--gray);">{{ user.email }}</span>
                    </div>
                </div>
                
                <div class="logs-container">
                    {% for log in logs %}
                        {% if log.user_id == user.id %}
                        <div class="log-item">
                            <div class="log-content">
                                <span class="log-action 
                                    {% if log.action_flag == 1 %}log-success
                                    {% elif log.action_flag == 2 %}log-warning
                                    {% elif log.action_flag == 3 %}log-error
                                    {% else %}log-info{% endif %}">
                                    <i class="material-icons">
                                        {% if log.action_flag == 1 %}add_circle
                                        {% elif log.action_flag == 2 %}edit
                                        {% elif log.action_flag == 3 %}delete
                                        {% else %}info{% endif %}
                                    </i>
                                    {{ log.get_action_flag_display }}
                                </span>
                                {% if log.content_type %}
                                <span class="log-details">
                                    {{ log.content_type.model|title }}: <strong>{{ log.object_repr|truncatechars:30 }}</strong>
                                </span>
                                {% endif %}
                                {% if log.change_message %}
                                <div class="log-details" style="margin-top: 0.5rem;">
                                    {{ log.change_message|truncatechars:100 }}
                                </div>
                                {% endif %}
                            </div>
                            <span class="log-time">{{ log.action_time|date:"M d, Y H:i" }}</span>
                        </div>
                        {% endif %}
                    {% endfor %}
                    
                    <div class="no-logs-message" style="display: none;">
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <i class="material-icons">history</i>
                            </div>
                            <h6>No Activity Logs</h6>
                            <p>No activity logs found for this user</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-modal btn-modal-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Delete Confirmation Modals -->
{% for user in users %}
<div class="modal fade" id="confirmDeleteModal{{ user.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form method="post" action="{% url 'delete_user' %}">
                {% csrf_token %}
                <input type="hidden" name="user_id" value="{{ user.id }}">
                <div class="modal-header" style="background: linear-gradient(135deg, var(--danger), #dc2626);">
                    <h5 class="modal-title">
                        <i class="material-icons me-2" style="font-size: 1.25rem;">warning</i>
                        Confirm Deletion
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="delete-warning">
                        <div class="delete-warning-icon">
                            <i class="material-icons">delete_forever</i>
                        </div>
                        <h5>Are you sure?</h5>
                        <p>You are about to delete user</p>
                        <p class="username">{{ user.username }}</p>
                        <p class="warning-text">
                            <i class="material-icons" style="font-size: 1rem; vertical-align: middle;">error</i>
                            This action cannot be undone.
                        </p>
                    </div>
                </div>
                <div class="modal-footer" style="justify-content: center;">
                    <button type="button" class="btn-modal btn-modal-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn-modal btn-modal-danger">
                        <i class="material-icons me-1" style="font-size: 1.1rem;">delete</i>
                        Delete User
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}
{% endblock content %}

{% block script %}
document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const usersTableBody = document.getElementById('usersTableBody');
    const userSearch = document.getElementById('userSearch');
    const roleFilter = document.getElementById('roleFilter');
    const userFilterTags = document.getElementById('userFilterTags');
    const addUserBtn = document.getElementById('addUserBtn');
    const userCountEl = document.getElementById('userCount');
    
    // Add User Modal
    const userModal = new bootstrap.Modal(document.getElementById('userModal'));
    
    // Get all table rows
    const allRows = Array.from(usersTableBody.querySelectorAll('tr')).filter(row => row.querySelector('.user-info'));
    
    // Filter users
    function filterUsers() {
        const searchTerm = userSearch.value.toLowerCase().trim();
        const roleValue = roleFilter.value.toLowerCase();
        
        let visibleCount = 0;
        
        allRows.forEach(row => {
            const userInfo = row.querySelector('.user-info');
            const userName = userInfo ? userInfo.textContent.toLowerCase() : '';
            const email = row.querySelector('.user-email')?.textContent.toLowerCase() || '';
            const role = row.querySelector('.role-badge')?.textContent.toLowerCase().trim() || '';
            
            const matchesSearch = !searchTerm || 
                userName.includes(searchTerm) || 
                email.includes(searchTerm);
            
            const matchesRole = !roleValue || role.includes(roleValue);
            
            if (matchesSearch && matchesRole) {
                row.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
            }
        });
        
        // Update count
        if (userCountEl) {
            userCountEl.textContent = visibleCount;
        }
        
        // Update filter tags
        updateFilterTags();
        
        // Show empty state if needed
        showEmptyState(visibleCount === 0);
    }
    
    function showEmptyState(show) {
        let emptyRow = usersTableBody.querySelector('.empty-state-row');
        
        if (show && !emptyRow) {
            emptyRow = document.createElement('tr');
            emptyRow.className = 'empty-state-row';
            emptyRow.innerHTML = `
                <td colspan="4">
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="material-icons">search_off</i>
                        </div>
                        <h6>No Users Found</h6>
                        <p>No users match your current filters</p>
                    </div>
                </td>
            `;
            usersTableBody.appendChild(emptyRow);
        } else if (!show && emptyRow) {
            emptyRow.remove();
        } else if (show && emptyRow) {
            emptyRow.style.display = '';
        }
    }
    
    function updateFilterTags() {
        userFilterTags.innerHTML = '';
        
        if (userSearch.value) {
            addFilterTag('search', 'Search', `"${userSearch.value}"`);
        }
        
        if (roleFilter.value) {
            const roleText = roleFilter.options[roleFilter.selectedIndex].text;
            addFilterTag('role', 'Role', roleText);
        }
    }
    
    function addFilterTag(type, label, value) {
        const tag = document.createElement('div');
        tag.className = 'filter-tag';
        tag.innerHTML = `
            ${label}: ${value}
            <span class="filter-tag-remove" data-filter="${type}">
                <i class="material-icons">close</i>
            </span>
        `;
        userFilterTags.appendChild(tag);
        
        tag.querySelector('.filter-tag-remove').addEventListener('click', function() {
            clearFilter(this.dataset.filter);
        });
    }
    
    function clearFilter(type) {
        if (type === 'search') {
            userSearch.value = '';
        } else if (type === 'role') {
            roleFilter.value = '';
        }
        filterUsers();
    }
    
    // Event listeners
    if (userSearch) {
        userSearch.addEventListener('input', filterUsers);
    }
    
    if (roleFilter) {
        roleFilter.addEventListener('change', filterUsers);
    }
    
    if (addUserBtn) {
        addUserBtn.addEventListener('click', function() {
            userModal.show();
        });
    }
    
    // Password validation
    const password = document.getElementById('password');
    const passwordConfirm = document.getElementById('password_confirm');
    const passwordError = document.getElementById('passwordError');
    
    function validatePasswords() {
        if (password.value !== passwordConfirm.value) {
            passwordConfirm.classList.add('is-invalid');
            passwordError.style.display = 'block';
            return false;
        } else {
            passwordConfirm.classList.remove('is-invalid');
            passwordError.style.display = 'none';
            return true;
        }
    }
    
    if (password && passwordConfirm) {
        passwordConfirm.addEventListener('input', validatePasswords);
        password.addEventListener('input', validatePasswords);
    }
    
    // Form submission
    const addUserForm = document.getElementById('addUserForm');
    if (addUserForm) {
        addUserForm.addEventListener('submit', function(e) {
            if (!validatePasswords()) {
                e.preventDefault();
            }
        });
    }
    
    // Handle logs empty state
    document.querySelectorAll('.logs-container').forEach(container => {
        const logItems = container.querySelectorAll('.log-item');
        const noLogsMessage = container.querySelector('.no-logs-message');
        
        if (logItems.length > 0 && noLogsMessage) {
            noLogsMessage.style.display = 'none';
        } else if (noLogsMessage) {
            noLogsMessage.style.display = 'block';
        }
    });
    
    // Initialize
    filterUsers();
});
{% endblock script %}